!function(){"use strict";!function(){function e(e){switch(e){case"compass":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" /><polygon points="12,6 8,16 12,13 16,16" fill="currentColor" /></svg>';case"info":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" /><rect x="11" y="10" width="2" height="7" fill="currentColor" /><circle cx="12" cy="8" r="1" fill="currentColor" /></svg>';case"search":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="5.5" fill="none" stroke="currentColor" stroke-width="2" /><line x1="15" y1="15" x2="20" y2="20" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg>';case"dockRight":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="5" width="16" height="14" rx="1.5" ry="1.5" fill="none" stroke="currentColor" stroke-width="2" /><rect x="13" y="5" width="7" height="14" fill="currentColor" /></svg>';default:return""}}document.addEventListener("DOMContentLoaded",function(){!function(){if(window.PathPilotStatus&&!0===window.PathPilotStatus.insights_only)return void console.log("Path Pilot: Insights only mode enabled - skipping drawer initialization");if(!document.querySelector('link[href*="path-pilot-icons.css"]')){var t=document.createElement("link");t.rel="stylesheet",t.href=window.PathPilotStatus&&window.PathPilotStatus.icon_css_url||"/wp-content/plugins/path-pilot/assets/css/path-pilot-icons.css",document.head.appendChild(t)}let n=window.PathPilotStatus?window.PathPilotStatus.nonce:null;function o(){return fetch("/wp-json/path-pilot/v1/nonce").then(e=>e.json()).then(e=>(e.nonce&&(n=e.nonce),n)).catch(()=>n)}async function a(e,t){const a=n=>{const o={...t.headers,"X-WP-Nonce":n};return fetch(e,{...t,headers:o})};let i=await a(n);if(403===i.status){const e=await o();i=await a(e)}return i}o();let i=!1,s=null;const c="path_pilot_drawer_state";function r(){try{const e=window.localStorage?localStorage.getItem(c):null;return e?JSON.parse(e):null}catch(e){return null}}function l(){try{if(!window.localStorage)return;const e={open:i,tab:s||null};localStorage.setItem(c,JSON.stringify(e))}catch(e){}}const d=[{id:"recommendations",label:"Recommendations",icon:"compass"},{id:"summary",label:"Page summary",icon:"info"},{id:"search",label:"Search",icon:"search"}],p=document.createElement("div");p.id="path-pilot-sidebar",p.className="pp-sidebar collapsed",p.setAttribute("role","complementary"),p.setAttribute("aria-label","Path Pilot panel"),p.setAttribute("aria-hidden","true"),document.body.appendChild(p),document.body.classList.add("pp-sidebar-present");const u=document.createElement("div");u.className="pp-sidebar-inner",p.appendChild(u);const h=document.createElement("button");h.type="button",h.className="pp-sidebar-brand",h.innerHTML='<i class="icon-pilot-icon" aria-hidden="true"></i>',h.setAttribute("title","Path Pilot"),h.setAttribute("aria-label","Open Path Pilot website"),h.addEventListener("click",function(){try{window.open("https://pathpilot.app","_blank","noopener,noreferrer")}catch(e){window.location.href="https://pathpilot.app"}}),u.appendChild(h);const m=document.createElement("nav");m.className="pp-sidebar-nav",m.setAttribute("aria-label","Path Pilot navigation"),u.appendChild(m);const b=document.createElement("div");b.className="pp-sidebar-content",p.appendChild(b);const f=document.createElement("button");f.type="button",f.className="pp-panel-close",f.setAttribute("aria-label","Close Path Pilot panel"),f.innerHTML=e("dockRight"),b.appendChild(f);const w=document.createElement("div");w.className="pp-drawer-title",w.textContent="Recommendations",b.appendChild(w);const y=document.createElement("div");y.className="pp-tab-root pp-tab-recommendations";const v=document.createElement("ul");v.className="pp-drawer-rec-list",y.appendChild(v),b.appendChild(y);const g=document.createElement("div");g.className="pp-tab-root pp-tab-summary",g.style.display="none",b.appendChild(g);const C=document.createElement("div");C.className="pp-tab-root pp-tab-search",C.style.display="none",b.appendChild(C);const P={recommendations:y,summary:g,search:C},E=d.map(t=>{const n=document.createElement("button");return n.type="button",n.className="pp-nav-btn",n.setAttribute("data-view",t.id),n.setAttribute("title",t.label),n.setAttribute("aria-label",t.label),n.innerHTML=e(t.icon),m.appendChild(n),{...t,button:n,section:P[t.id]||null}});function k(e){v.innerHTML="",e&&0!==e.length?e.forEach(function(e){const t=document.createElement("li"),n=document.createElement("div");n.className="pp-drawer-rec-title-row";const o=document.createElement("div");if(o.className="pp-rec-meta",e.badge){const t=document.createElement("span");t.className="pp-drawer-rec-badge pp-badge-"+e.badge,"conversion_path"===e.badge?t.textContent="Recommended":"popular"===e.badge?t.textContent="Popular":"related"===e.badge?t.textContent="Related":"newest"===e.badge&&(t.textContent="Newest"),o.appendChild(t)}if(e.score&&e.score>0){const t=document.createElement("span");t.className="pp-drawer-rec-percent",t.textContent=Math.round(e.score)+"%",o.appendChild(t)}o.children.length>0&&n.appendChild(o);const i=document.createElement("span");if(i.className="pp-drawer-rec-title",i.textContent=e.title,n.appendChild(i),t.appendChild(n),e.synopsis){const n=document.createElement("div");n.className="pp-drawer-rec-synopsis",n.textContent=e.synopsis,t.appendChild(n)}t.style.cursor="pointer",t.addEventListener("click",function(){if(void 0!==e.page_id){const t=(document.cookie.match(/path_pilot_sid=([^;]+)/)||[])[1]||"";a("/wp-json/path-pilot/v1/rec-click",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,page_id:e.page_id})})}window.location.href=e.url}),v.appendChild(t)}):v.innerHTML='<li style="color:#aaa;font-size:0.95em;">No recommendations yet.</li>'}function N(e=3){const t=b.querySelector(".pp-drawer-rec-list");if(t){t.innerHTML="";for(let n=0;n<e;n++)t.innerHTML+='\n          <li class="pp-rec-skeleton">\n            <div class="pp-skeleton-title"></div>\n            <div class="pp-skeleton-synopsis"></div>\n            <div class="pp-skeleton-synopsis" style="width: 70%;"></div>\n          </li>\n        '}}function x(){N(3),a("/wp-json/path-pilot/v1/suggest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({current:window.location.pathname,history:JSON.parse(sessionStorage.getItem("path_pilot_history")||"[]")})}).then(e=>e.json()).then(e=>{console.log("Path Pilot: Received recommendations data:",e),e&&e.recommendations?k(e.recommendations):(console.warn("Path Pilot: No recommendations in response"),k([]))}).catch(e=>{console.error("Path Pilot: Error fetching recommendations:",e),k([])})}function S(e){const t=b.querySelector(".pp-drawer-title");t&&(t.textContent=e)}function L(){i||(i=!0,p.classList.remove("collapsed"),p.classList.add("expanded"),p.setAttribute("aria-hidden","false"),document.body.classList.add("pp-sidebar-open"),b.dataset.loaded||(x(),b.dataset.loaded="1"),l())}function _(){if(i){try{const e=document.activeElement;if(e&&p.contains(e)){const e=p.querySelector(".pp-sidebar-brand")||document.body;e&&"function"==typeof e.focus&&e.focus()}}catch(e){}i=!1,p.classList.remove("expanded"),p.classList.add("collapsed"),p.setAttribute("aria-hidden","true"),document.body.classList.remove("pp-sidebar-open"),s=null,l()}}function A(e){s=e,E.forEach(t=>{const n=t.id===e;t.button&&t.button.classList.toggle("is-active",n),t.section&&(t.section.style.display=n?"":"none")});const t=E.find(t=>t.id===e);t&&S(t.label)}function T(e){if(!i)return A(e.id),void L();A(e.id),l()}E.forEach(e=>{e.button&&e.button.addEventListener("click",function(){T(e)})}),f.addEventListener("click",function(){_()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&_()});const M=r();if(M&&M.open){const e=E.length?E[0].id:null,t=M.tab&&E.some(e=>e.id===M.tab)?M.tab:e;t&&(A(t),L())}}()})}()}();
