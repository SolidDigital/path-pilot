!function(){"use strict";!function(){function e(e){switch(e){case"compass":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" /><polygon points="12,6 8,16 12,13 16,16" fill="currentColor" /></svg>';case"info":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" /><rect x="11" y="10" width="2" height="7" fill="currentColor" /><circle cx="12" cy="8" r="1" fill="currentColor" /></svg>';case"search":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="5.5" fill="none" stroke="currentColor" stroke-width="2" /><line x1="15" y1="15" x2="20" y2="20" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg>';case"dockRight":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="5" width="16" height="14" rx="1.5" ry="1.5" fill="none" stroke="currentColor" stroke-width="2" /><rect x="13" y="5" width="7" height="14" fill="currentColor" /></svg>';case"close":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" /><line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg>';default:return""}}document.addEventListener("DOMContentLoaded",function(){!function(){if(window.PathPilotStatus&&!0===window.PathPilotStatus.insights_only)return void console.log("Path Pilot: Insights only mode enabled - skipping drawer initialization");if(!document.querySelector('link[href*="path-pilot-icons.css"]')){var t=document.createElement("link");t.rel="stylesheet",t.href=window.PathPilotStatus&&window.PathPilotStatus.icon_css_url||"/wp-content/plugins/path-pilot/assets/css/path-pilot-icons.css",document.head.appendChild(t)}let n=window.PathPilotStatus?window.PathPilotStatus.nonce:null;function a(){return fetch("/wp-json/path-pilot/v1/nonce").then(e=>e.json()).then(e=>(e.nonce&&(n=e.nonce),n)).catch(()=>n)}async function o(e,t){const o=n=>{const a={...t.headers,"X-WP-Nonce":n};return fetch(e,{...t,headers:a})};let i=await o(n);if(403===i.status){const e=await a();i=await o(e)}return i}function i(){if("undefined"==typeof window)return!1;if(window.matchMedia)try{return window.matchMedia("(max-width: 900px)").matches}catch(e){}return window.innerWidth<=900}a();let s=!1,r=null;const l="path_pilot_drawer_state";function c(){try{const e=window.localStorage?localStorage.getItem(l):null;return e?JSON.parse(e):null}catch(e){return null}}function d(){try{if(!window.localStorage)return;if(i())return void localStorage.removeItem(l);const e={open:s,tab:r||null};localStorage.setItem(l,JSON.stringify(e))}catch(e){}}const p=[{id:"recommendations",label:"Site navigation",icon:"compass"},...window.PathPilotPro||window.PathPilotStatus&&(window.PathPilotStatus.has_pro||window.PathPilotStatus.is_pro)?[{id:"summary",label:"Page summary",icon:"info"},{id:"search",label:"Search",icon:"search"}]:[]],u=document.createElement("div");u.id="path-pilot-sidebar",u.className="pp-sidebar collapsed",u.setAttribute("role","complementary"),u.setAttribute("aria-label","Path Pilot panel"),u.setAttribute("aria-hidden","true"),document.body.appendChild(u),document.body.classList.add("pp-sidebar-present");const m=document.createElement("div");m.className="pp-sidebar-inner",u.appendChild(m);const h=document.createElement("button");h.type="button",h.className="pp-sidebar-brand",h.innerHTML='<i class="icon-pilot-icon" aria-hidden="true"></i>',h.setAttribute("title","Path Pilot"),h.setAttribute("aria-label","Open Path Pilot website"),h.addEventListener("click",function(){try{window.open("https://pathpilot.app","_blank","noopener,noreferrer")}catch(e){window.location.href="https://pathpilot.app"}}),m.appendChild(h);const f=document.createElement("nav");f.className="pp-sidebar-nav",f.setAttribute("aria-label","Path Pilot navigation"),m.appendChild(f);const y=document.createElement("div");y.className="pp-sidebar-content",u.appendChild(y);const w=document.createElement("button");w.type="button",w.className="pp-panel-close",w.setAttribute("aria-label","Close Path Pilot panel"),w.innerHTML=i()?e("close"):e("dockRight"),y.appendChild(w);const g=document.createElement("div");g.className="pp-drawer-title",g.textContent="Site navigation",y.appendChild(g);const v=document.createElement("div");v.className="pp-tab-root pp-tab-recommendations",y.appendChild(v);const b=document.createElement("div");b.className="pp-tab-root pp-tab-summary",b.style.display="none",y.appendChild(b);const C=document.createElement("div");C.className="pp-tab-root pp-tab-search",C.style.display="none",y.appendChild(C);const S={recommendations:v,summary:b,search:C},P=p.map(t=>{const n=document.createElement("button");return n.type="button",n.className="pp-nav-btn",n.setAttribute("data-view",t.id),n.setAttribute("title",t.label),n.setAttribute("aria-label",t.label),n.innerHTML=e(t.icon),f.appendChild(n),{...t,button:n,section:S[t.id]||null}});function E(){if("undefined"==typeof window||!window.localStorage)return[];try{const e=localStorage.getItem("path_pilot_recent_pages");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}}function N(){if("undefined"==typeof window||!window.localStorage)return;const e=window.location.pathname||"",t=window.location.href||e||"",n=document.title||t||e||"";let a=E().filter(t=>t.path!==e);a.unshift({path:e,url:t,title:n}),a.length>3&&(a=a.slice(0,3));try{localStorage.setItem("path_pilot_recent_pages",JSON.stringify(a))}catch(e){}}function k(e){return function(t){if(t&&"function"==typeof t.preventDefault&&t.preventDefault(),void 0!==e.page_id){const t=(document.cookie.match(/path_pilot_sid=([^;]+)/)||[])[1]||"";o("/wp-json/path-pilot/v1/rec-click",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,page_id:e.page_id})})}window.location.href=e.url}}function _(e,t){const n=!t||!1!==t.showScore,a=document.createElement("a");a.className="pp-rec-card-row",e.url&&(a.href=e.url);const o=document.createElement("div");o.className="pp-rec-card-title",o.textContent=e.title,a.appendChild(o);const i=document.createElement("div");if(i.className="pp-rec-card-meta",n&&e.score&&e.score>0){const t=document.createElement("span");t.className="pp-rec-card-percent",t.textContent=Math.round(e.score)+"%",i.appendChild(t)}return a.appendChild(i),a.addEventListener("click",k(e)),a}function L(e,t){const n=document.createElement("li");n.className="pp-rec-list-item";const a=_(e,t);return n.appendChild(a),n}function x(e){if(v.innerHTML="",!e||0===e.length)return void(v.innerHTML='<div style="color:#aaa;font-size:0.95em;">No recommendations yet.</div>');const t=document.createElement("div");t.className="pp-rec-layout",v.appendChild(t);const n=e.filter(e=>"conversion_path"===e.badge),a=e.filter(e=>"popular"===e.badge);e.filter(e=>"related"===e.badge);const o=e.filter(e=>"newest"===e.badge);function i(t,n,a){return t.length?t:e.slice(n,a)}const s=i(n,0,3),r=i(a,0,3),l=i(o,6,9),c=window.location&&window.location.pathname?window.location.pathname:"",d=E().filter(e=>e.path!==c);function p(e,n,a={}){if(!n||!n.length)return;const o=document.createElement("section");o.className="pp-rec-group",a.isSuggested&&o.classList.add("pp-rec-group-suggested");const i=document.createElement("div");if(i.className="pp-rec-group-title",i.textContent=e,o.appendChild(i),a.isSuggested){const e=document.createElement("div");e.className="pp-rec-ai-badge",e.innerHTML='<svg width="30" height="18" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.3997 5.58699C8.86707 4.64902 6.87087 2.65284 5.93292 0.12024C5.87386 -0.04008 5.64675 -0.04008 5.58699 0.12024C4.64902 2.65284 2.65284 4.64904 0.12024 5.58699C-0.04008 5.64605 -0.04008 5.87316 0.12024 5.93292C2.65284 6.87088 4.64904 8.86707 5.58699 11.3997C5.64605 11.56 5.87316 11.56 5.93292 11.3997C6.87088 8.86707 8.86707 6.87087 11.3997 5.93292C11.56 5.87386 11.56 5.64675 11.3997 5.58699Z" fill="#9A9A9A"></path><g transform="translate(10 0)"><path d="M4.27437 2.09465C3.32375 1.74378 2.57487 0.994967 2.22402 0.0442969C2.20223 -0.0147656 2.11574 -0.0147656 2.09465 0.0442969C1.74378 0.994922 0.994967 1.7438 0.0442969 2.09465C-0.0147656 2.11644 -0.0147656 2.20293 0.0442969 2.22402C0.994922 2.57489 1.7438 3.3237 2.09465 4.27437C2.11644 4.33343 2.20293 4.33343 2.22402 4.27437C2.57489 3.32375 3.3237 2.57487 4.27437 2.22402C4.33344 2.20223 4.33344 2.11574 4.27437 2.09465Z" fill="#9A9A9A"></path></g></svg>',o.appendChild(e)}const s=document.createElement("ul");s.className="pp-rec-list",n.forEach(e=>{s.appendChild(L(e,{showScore:!!a.isSuggested}))}),o.appendChild(s),t.appendChild(o)}p("Suggested Next",s,{isSuggested:!0}),p("Most Popular",r),p("Recently Visited",d),p("Trending",l)}function M(e=3){v.innerHTML="";const t=document.createElement("div");t.className="pp-rec-skeleton-wrap";for(let n=0;n<e;n++)t.innerHTML+='\n          <div class="pp-rec-skeleton">\n            <div class="pp-skeleton-title"></div>\n            <div class="pp-skeleton-synopsis"></div>\n            <div class="pp-skeleton-synopsis" style="width: 70%;"></div>\n          </div>\n        ';v.appendChild(t)}function T(){M(3),o("/wp-json/path-pilot/v1/suggest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({current:window.location.pathname,history:JSON.parse(sessionStorage.getItem("path_pilot_history")||"[]")})}).then(e=>e.json()).then(e=>{console.log("Path Pilot: Received recommendations data:",e),e&&e.recommendations?x(e.recommendations):(console.warn("Path Pilot: No recommendations in response"),x([]))}).catch(e=>{console.error("Path Pilot: Error fetching recommendations:",e),x([])})}N(),T();let A=!1;function H(e=3){b.innerHTML="";for(let t=0;t<e;t++)b.innerHTML+='\n          <div class="pp-rec-skeleton">\n            <div class="pp-skeleton-title"></div>\n            <div class="pp-skeleton-synopsis"></div>\n            <div class="pp-skeleton-synopsis" style="width: 70%;"></div>\n          </div>\n        '}async function O(){if(A)return;A=!0;const e="path_pilot_summary_"+window.location.pathname;try{if(window.localStorage){const t=localStorage.getItem(e);if(t){const e=JSON.parse(t),n=864e5;if(e&&e.timestamp&&Date.now()-e.timestamp<n){b.innerHTML="";const t=document.createElement("div");t.className="pp-summary-page-title",t.textContent=document.title||"",b.appendChild(t);const n=document.createElement("div");if(n.className="pp-summary-body",n.innerHTML=e.summary_html||"",b.appendChild(n),Array.isArray(e.related_pages)&&e.related_pages.length){const t=document.createElement("div");t.className="pp-summary-related",t.innerHTML=`\n                  <div class="pp-summary-related-title">Related pages</div>\n                  <ul class="pp-summary-related-list">\n                    ${e.related_pages.map(e=>`<li><a href="${e.url}">${e.title}</a></li>`).join("")}\n                  </ul>\n                `,b.appendChild(t)}return}}}}catch(e){}H(3);try{const t=await fetch("/wp-json/path-pilot/v1/summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({path:window.location.pathname})}),n=await t.json();b.innerHTML="";const a=document.createElement("div");if(a.className="pp-summary-page-title",a.textContent=document.title||"",b.appendChild(a),!n||n.error)return void(b.innerHTML=`<div style="color:#aaa;font-size:0.9rem;">${n&&n.error||"Unable to load summary."}</div>`);const o=document.createElement("div");if(o.className="pp-summary-body",o.innerHTML=n.summary_html,b.appendChild(o),Array.isArray(n.related_pages)&&n.related_pages.length){const e=document.createElement("div");e.className="pp-summary-related",e.innerHTML=`\n            <div class="pp-summary-related-title">Related pages</div>\n            <ul class="pp-summary-related-list">\n              ${n.related_pages.map(e=>`<li><a href="${e.url}">${e.title}</a></li>`).join("")}\n            </ul>\n          `,b.appendChild(e)}try{window.localStorage&&localStorage.setItem(e,JSON.stringify({timestamp:Date.now(),summary_html:n.summary_html,related_pages:n.related_pages||[]}))}catch(e){}}catch(e){console.error("Path Pilot: Error loading page summary:",e),b.innerHTML='<div style="color:#aaa;font-size:0.9rem;">Error loading summary.</div>'}}function j(e){const t=y.querySelector(".pp-drawer-title");t&&(t.textContent=e)}function J(){s||(s=!0,u.classList.remove("collapsed"),u.classList.add("expanded"),u.setAttribute("aria-hidden","false"),document.body.classList.add("pp-sidebar-open"),d())}function I(){if(s){try{const e=document.activeElement;if(e&&u.contains(e)){const e=u.querySelector(".pp-sidebar-brand")||document.body;e&&"function"==typeof e.focus&&e.focus()}}catch(e){}s=!1,u.classList.remove("expanded"),u.classList.add("collapsed"),u.setAttribute("aria-hidden","true"),document.body.classList.remove("pp-sidebar-open"),r=null,P.forEach(e=>{e.button&&e.button.classList.remove("is-active"),e.section&&(e.section.style.display="none")}),d()}}function $(e){r=e,P.forEach(t=>{const n=t.id===e;t.button&&t.button.classList.toggle("is-active",n),t.section&&(t.section.style.display=n?"":"none")});const t=P.find(t=>t.id===e);t&&j(t.label)}function B(e){if(!s)return $(e.id),"summary"===e.id&&O(),void J();$(e.id),"summary"===e.id&&O(),d()}P.forEach(e=>{e.button&&e.button.addEventListener("click",function(){B(e)})}),w.addEventListener("click",function(){I()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&I()});const R=i()?null:c();if(R&&R.open){const e=P.length?P[0].id:null,t=R.tab&&P.some(e=>e.id===R.tab)?R.tab:e;t&&($(t),J(),"summary"===t&&O())}}()})}()}();
