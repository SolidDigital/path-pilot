!function(){"use strict";!function(){function e(e){switch(e){case"compass":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" /><polygon points="12,6 8,16 12,13 16,16" fill="currentColor" /></svg>';case"info":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" /><rect x="11" y="10" width="2" height="7" fill="currentColor" /><circle cx="12" cy="8" r="1" fill="currentColor" /></svg>';case"search":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="5.5" fill="none" stroke="currentColor" stroke-width="2" /><line x1="15" y1="15" x2="20" y2="20" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg>';case"dockRight":return'<svg class="pp-icon" viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="5" width="16" height="14" rx="1.5" ry="1.5" fill="none" stroke="currentColor" stroke-width="2" /><rect x="13" y="5" width="7" height="14" fill="currentColor" /></svg>';default:return""}}document.addEventListener("DOMContentLoaded",function(){!function(){if(window.PathPilotStatus&&!0===window.PathPilotStatus.insights_only)return void console.log("Path Pilot: Insights only mode enabled - skipping drawer initialization");if(!document.querySelector('link[href*="path-pilot-icons.css"]')){var t=document.createElement("link");t.rel="stylesheet",t.href=window.PathPilotStatus&&window.PathPilotStatus.icon_css_url||"/wp-content/plugins/path-pilot/assets/css/path-pilot-icons.css",document.head.appendChild(t)}let n=window.PathPilotStatus?window.PathPilotStatus.nonce:null;function a(){return fetch("/wp-json/path-pilot/v1/nonce").then(e=>e.json()).then(e=>(e.nonce&&(n=e.nonce),n)).catch(()=>n)}async function o(e,t){const o=n=>{const a={...t.headers,"X-WP-Nonce":n};return fetch(e,{...t,headers:a})};let i=await o(n);if(403===i.status){const e=await a();i=await o(e)}return i}a();let i=!1,s=null;const r="path_pilot_drawer_state";function l(){try{const e=window.localStorage?localStorage.getItem(r):null;return e?JSON.parse(e):null}catch(e){return null}}function c(){try{if(!window.localStorage)return;const e={open:i,tab:s||null};localStorage.setItem(r,JSON.stringify(e))}catch(e){}}const d=[{id:"recommendations",label:"Site navigation",icon:"compass"},{id:"summary",label:"Page summary",icon:"info"},{id:"search",label:"Search",icon:"search"}],p=document.createElement("div");p.id="path-pilot-sidebar",p.className="pp-sidebar collapsed",p.setAttribute("role","complementary"),p.setAttribute("aria-label","Path Pilot panel"),p.setAttribute("aria-hidden","true"),document.body.appendChild(p),document.body.classList.add("pp-sidebar-present");const u=document.createElement("div");u.className="pp-sidebar-inner",p.appendChild(u);const m=document.createElement("button");m.type="button",m.className="pp-sidebar-brand",m.innerHTML='<i class="icon-pilot-icon" aria-hidden="true"></i>',m.setAttribute("title","Path Pilot"),m.setAttribute("aria-label","Open Path Pilot website"),m.addEventListener("click",function(){try{window.open("https://pathpilot.app","_blank","noopener,noreferrer")}catch(e){window.location.href="https://pathpilot.app"}}),u.appendChild(m);const h=document.createElement("nav");h.className="pp-sidebar-nav",h.setAttribute("aria-label","Path Pilot navigation"),u.appendChild(h);const f=document.createElement("div");f.className="pp-sidebar-content",p.appendChild(f);const y=document.createElement("button");y.type="button",y.className="pp-panel-close",y.setAttribute("aria-label","Close Path Pilot panel"),y.innerHTML=e("dockRight"),f.appendChild(y);const g=document.createElement("div");g.className="pp-drawer-title",g.textContent="Site navigation",f.appendChild(g);const w=document.createElement("div");w.className="pp-tab-root pp-tab-recommendations",f.appendChild(w);const v=document.createElement("div");v.className="pp-tab-root pp-tab-summary",v.style.display="none",f.appendChild(v);const b=document.createElement("div");b.className="pp-tab-root pp-tab-search",b.style.display="none",f.appendChild(b);const C={recommendations:w,summary:v,search:b},S=d.map(t=>{const n=document.createElement("button");return n.type="button",n.className="pp-nav-btn",n.setAttribute("data-view",t.id),n.setAttribute("title",t.label),n.setAttribute("aria-label",t.label),n.innerHTML=e(t.icon),h.appendChild(n),{...t,button:n,section:C[t.id]||null}});function E(){if("undefined"==typeof window||!window.localStorage)return[];try{const e=localStorage.getItem("path_pilot_recent_pages");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}}function N(){if("undefined"==typeof window||!window.localStorage)return;const e=window.location.pathname||"",t=window.location.href||e||"",n=document.title||t||e||"";let a=E().filter(t=>t.path!==e);a.unshift({path:e,url:t,title:n}),a.length>3&&(a=a.slice(0,3));try{localStorage.setItem("path_pilot_recent_pages",JSON.stringify(a))}catch(e){}}function P(e){return function(t){if(t&&"function"==typeof t.preventDefault&&t.preventDefault(),void 0!==e.page_id){const t=(document.cookie.match(/path_pilot_sid=([^;]+)/)||[])[1]||"";o("/wp-json/path-pilot/v1/rec-click",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t,page_id:e.page_id})})}window.location.href=e.url}}function _(e,t){const n=!t||!1!==t.showScore,a=document.createElement("a");a.className="pp-rec-card-row",e.url&&(a.href=e.url);const o=document.createElement("div");o.className="pp-rec-card-title",o.textContent=e.title,a.appendChild(o);const i=document.createElement("div");if(i.className="pp-rec-card-meta",n&&e.score&&e.score>0){const t=document.createElement("span");t.className="pp-rec-card-percent",t.textContent=Math.round(e.score)+"%",i.appendChild(t)}return a.appendChild(i),a.addEventListener("click",P(e)),a}function k(e,t){const n=document.createElement("li");n.className="pp-rec-list-item";const a=_(e,t);return n.appendChild(a),n}function L(e){if(w.innerHTML="",!e||0===e.length)return void(w.innerHTML='<div style="color:#aaa;font-size:0.95em;">No recommendations yet.</div>');const t=document.createElement("div");t.className="pp-rec-layout",w.appendChild(t);const n=e.filter(e=>"conversion_path"===e.badge),a=e.filter(e=>"popular"===e.badge);e.filter(e=>"related"===e.badge);const o=e.filter(e=>"newest"===e.badge);function i(t,n,a){return t.length?t:e.slice(n,a)}const s=i(n,0,3),r=i(a,0,3),l=i(o,6,9),c=window.location&&window.location.pathname?window.location.pathname:"",d=E().filter(e=>e.path!==c);function p(e,n,a={}){if(!n||!n.length)return;const o=document.createElement("section");o.className="pp-rec-group",a.isSuggested&&o.classList.add("pp-rec-group-suggested");const i=document.createElement("div");if(i.className="pp-rec-group-title",i.textContent=e,o.appendChild(i),a.isSuggested){const e=document.createElement("div");e.className="pp-rec-ai-badge",e.innerHTML='<svg width="30" height="18" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.3997 5.58699C8.86707 4.64902 6.87087 2.65284 5.93292 0.12024C5.87386 -0.04008 5.64675 -0.04008 5.58699 0.12024C4.64902 2.65284 2.65284 4.64904 0.12024 5.58699C-0.04008 5.64605 -0.04008 5.87316 0.12024 5.93292C2.65284 6.87088 4.64904 8.86707 5.58699 11.3997C5.64605 11.56 5.87316 11.56 5.93292 11.3997C6.87088 8.86707 8.86707 6.87087 11.3997 5.93292C11.56 5.87386 11.56 5.64675 11.3997 5.58699Z" fill="#9A9A9A"></path><g transform="translate(10 0)"><path d="M4.27437 2.09465C3.32375 1.74378 2.57487 0.994967 2.22402 0.0442969C2.20223 -0.0147656 2.11574 -0.0147656 2.09465 0.0442969C1.74378 0.994922 0.994967 1.7438 0.0442969 2.09465C-0.0147656 2.11644 -0.0147656 2.20293 0.0442969 2.22402C0.994922 2.57489 1.7438 3.3237 2.09465 4.27437C2.11644 4.33343 2.20293 4.33343 2.22402 4.27437C2.57489 3.32375 3.3237 2.57487 4.27437 2.22402C4.33344 2.20223 4.33344 2.11574 4.27437 2.09465Z" fill="#9A9A9A"></path></g></svg>',o.appendChild(e)}const s=document.createElement("ul");s.className="pp-rec-list",n.forEach(e=>{s.appendChild(k(e,{showScore:!!a.isSuggested}))}),o.appendChild(s),t.appendChild(o)}p("Suggested Next",s,{isSuggested:!0}),p("Most Popular",r),p("Recently Visited",d),p("Trending",l)}function x(e=3){w.innerHTML="";const t=document.createElement("div");t.className="pp-rec-skeleton-wrap";for(let n=0;n<e;n++)t.innerHTML+='\n          <div class="pp-rec-skeleton">\n            <div class="pp-skeleton-title"></div>\n            <div class="pp-skeleton-synopsis"></div>\n            <div class="pp-skeleton-synopsis" style="width: 70%;"></div>\n          </div>\n        ';w.appendChild(t)}function T(){x(3),o("/wp-json/path-pilot/v1/suggest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({current:window.location.pathname,history:JSON.parse(sessionStorage.getItem("path_pilot_history")||"[]")})}).then(e=>e.json()).then(e=>{console.log("Path Pilot: Received recommendations data:",e),e&&e.recommendations?L(e.recommendations):(console.warn("Path Pilot: No recommendations in response"),L([]))}).catch(e=>{console.error("Path Pilot: Error fetching recommendations:",e),L([])})}N();let A=!1;function M(e=3){v.innerHTML="";for(let t=0;t<e;t++)v.innerHTML+='\n          <div class="pp-rec-skeleton">\n            <div class="pp-skeleton-title"></div>\n            <div class="pp-skeleton-synopsis"></div>\n            <div class="pp-skeleton-synopsis" style="width: 70%;"></div>\n          </div>\n        '}async function H(){if(A)return;A=!0;const e="path_pilot_summary_"+window.location.pathname;try{if(window.localStorage){const t=localStorage.getItem(e);if(t){const e=JSON.parse(t),n=864e5;if(e&&e.timestamp&&Date.now()-e.timestamp<n){v.innerHTML="";const t=document.createElement("div");t.className="pp-summary-page-title",t.textContent=document.title||"",v.appendChild(t);const n=document.createElement("div");if(n.className="pp-summary-body",n.innerHTML=e.summary_html||"",v.appendChild(n),Array.isArray(e.related_pages)&&e.related_pages.length){const t=document.createElement("div");t.className="pp-summary-related",t.innerHTML=`\n                  <div class="pp-summary-related-title">Related pages</div>\n                  <ul class="pp-summary-related-list">\n                    ${e.related_pages.map(e=>`<li><a href="${e.url}">${e.title}</a></li>`).join("")}\n                  </ul>\n                `,v.appendChild(t)}return}}}}catch(e){}M(3);try{const t=await fetch("/wp-json/path-pilot/v1/summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({path:window.location.pathname})}),n=await t.json();v.innerHTML="";const a=document.createElement("div");if(a.className="pp-summary-page-title",a.textContent=document.title||"",v.appendChild(a),!n||n.error)return void(v.innerHTML=`<div style="color:#aaa;font-size:0.9rem;">${n&&n.error||"Unable to load summary."}</div>`);const o=document.createElement("div");if(o.className="pp-summary-body",o.innerHTML=n.summary_html,v.appendChild(o),Array.isArray(n.related_pages)&&n.related_pages.length){const e=document.createElement("div");e.className="pp-summary-related",e.innerHTML=`\n            <div class="pp-summary-related-title">Related pages</div>\n            <ul class="pp-summary-related-list">\n              ${n.related_pages.map(e=>`<li><a href="${e.url}">${e.title}</a></li>`).join("")}\n            </ul>\n          `,v.appendChild(e)}try{window.localStorage&&localStorage.setItem(e,JSON.stringify({timestamp:Date.now(),summary_html:n.summary_html,related_pages:n.related_pages||[]}))}catch(e){}}catch(e){console.error("Path Pilot: Error loading page summary:",e),v.innerHTML='<div style="color:#aaa;font-size:0.9rem;">Error loading summary.</div>'}}function O(e){const t=f.querySelector(".pp-drawer-title");t&&(t.textContent=e)}function j(){i||(i=!0,p.classList.remove("collapsed"),p.classList.add("expanded"),p.setAttribute("aria-hidden","false"),document.body.classList.add("pp-sidebar-open"),f.dataset.loaded||(T(),f.dataset.loaded="1"),c())}function J(){if(i){try{const e=document.activeElement;if(e&&p.contains(e)){const e=p.querySelector(".pp-sidebar-brand")||document.body;e&&"function"==typeof e.focus&&e.focus()}}catch(e){}i=!1,p.classList.remove("expanded"),p.classList.add("collapsed"),p.setAttribute("aria-hidden","true"),document.body.classList.remove("pp-sidebar-open"),s=null,c()}}function I(e){s=e,S.forEach(t=>{const n=t.id===e;t.button&&t.button.classList.toggle("is-active",n),t.section&&(t.section.style.display=n?"":"none")});const t=S.find(t=>t.id===e);t&&O(t.label)}function $(e){if(!i)return I(e.id),"summary"===e.id&&H(),void j();I(e.id),"summary"===e.id&&H(),c()}S.forEach(e=>{e.button&&e.button.addEventListener("click",function(){$(e)})}),y.addEventListener("click",function(){J()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&J()});const R=l();if(R&&R.open){const e=S.length?S[0].id:null,t=R.tab&&S.some(e=>e.id===R.tab)?R.tab:e;t&&(I(t),j(),"summary"===t&&H())}}()})}()}();
